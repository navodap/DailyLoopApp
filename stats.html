<!DOCTYPE html>
<html lang="en">
<head>
<title>Stats - DailyLoop</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: "Segoe UI", system-ui, sans-serif;
  background: linear-gradient(135deg, #f7c6d8, #f3dbe5);
  min-height: 100vh;
  color: #3a1f2d;
  display: flex;
}

/* ---------- SIDE MENU ---------- */
.side-menu {
  width: 80px;
  height: 100vh;
  background: rgba(255, 255, 255, 0.25);
  border-right: 1px solid rgba(255, 255, 255, 0.4);
  backdrop-filter: blur(10px);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 40px;
  gap: 35px;
  z-index: 100;
  flex-shrink: 0;
}

.menu-item {
  width: 50px;
  height: 50px;
  border-radius: 14px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.25s ease;
  background: rgba(255, 255, 255, 0.3);
  border: 1px solid rgba(255, 255, 255, 0.4);
  color: #3a1f2d;
  font-size: 20px;
  padding: 6px 0;
}

.menu-item:hover {
  background: rgba(255, 255, 255, 0.6);
  transform: translateY(-2px);
}

.menu-item.active {
  background: rgba(255, 90, 158, 0.2);
  border-color: #ff5a9e;
  color: #ff5a9e;
}

.menu-item span {
  font-size: 11px;
  margin-top: 4px;
  display: block;
  text-align: center;
  width: 100%;
  line-height: 1.2;
}

/* ---------- MAIN CONTENT ---------- */
.main-content {
  flex: 1;
  padding: 30px;
  overflow-y: auto;
  height: 100vh;
}

/* ---------- STATS HEADER ---------- */
.stats-header {
  margin-bottom: 30px;
}

.stats-header h1 {
  font-size: 32px;
  font-weight: 600;
  color: var(--text-color);
  margin-bottom: 10px;
}

.stats-header p {
  color: rgba(var(--text-color-rgb), 0.7);
  font-size: 16px;
}

/* ---------- STATS GRID ---------- */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 25px;
  max-width: 1400px;
}

/* ---------- STAT CARD ---------- */
.stat-card {
  background: var(--glass-bg);
  backdrop-filter: blur(14px);
  border: 1px solid rgba(255, 255, 255, 0.6);
  border-radius: 20px;
  padding: 25px;
  box-shadow: 0 15px 40px rgba(0,0,0,0.08);
  transition: transform 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-5px);
}

.stat-card h3 {
  font-size: 20px;
  margin-bottom: 20px;
  color: var(--primary-color);
  display: flex;
  align-items: center;
  gap: 10px;
}

/* ---------- CHART STYLES ---------- */
.completion-chart {
  height: 200px;
  display: flex;
  align-items: flex-end;
  gap: 12px;
  margin-top: 15px;
  padding: 10px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 12px;
}

.chart-bar-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100%;
  justify-content: flex-end;
  flex: 1;
}

.chart-bar {
  width: 100%;
  background: var(--primary-color);
  border-radius: 8px 8px 0 0;
  min-height: 10px;
  transition: height 0.5s ease;
}

.chart-day {
  font-size: 12px;
  margin-top: 8px;
  opacity: 0.7;
}

/* ---------- STREAK LIST ---------- */
.streak-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 15px;
}

.streak-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 14px;
  transition: all 0.3s ease;
}

.streak-item:hover {
  background: rgba(255, 255, 255, 0.4);
}

.streak-badge {
  background: rgba(var(--primary-color-rgb), 0.15);
  color: var(--primary-color);
  padding: 6px 12px;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 6px;
}

.streak-badge.high {
  background: rgba(var(--primary-color-rgb), 0.25);
}

.streak-badge.medium {
  background: rgba(var(--primary-color-rgb), 0.2);
}

.streak-badge.low {
  background: rgba(var(--primary-color-rgb), 0.1);
}

/* ---------- PROGRESS BARS ---------- */
.progress-container {
  margin: 15px 0;
}

.habit-progress {
  margin-bottom: 15px;
}

.habit-progress-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
  font-size: 14px;
}

.progress-bg {
  height: 10px;
  width: 100%;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 5px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--primary-color);
  border-radius: 5px;
  transition: width 1s ease;
}

/* ---------- MONTH STATS ---------- */
.month-stats-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
  margin-top: 15px;
}

.month-stat {
  background: rgba(255, 255, 255, 0.2);
  padding: 15px;
  border-radius: 12px;
  text-align: center;
}

.month-stat-value {
  font-size: 24px;
  font-weight: 700;
  color: var(--primary-color);
  margin-bottom: 5px;
}

.month-stat-label {
  font-size: 12px;
  opacity: 0.7;
}

/* ===== DYNAMIC THEME VARIABLES ===== */
:root {
  --primary-gradient: linear-gradient(135deg, #f7c6d8, #f3dbe5);
  --primary-color: #ff5a9e;
  --primary-color-rgb: 255, 90, 158;
  --text-color: #3a1f2d;
  --text-color-rgb: 58, 31, 45;
  --bg-color: rgba(255, 255, 255, 0.45);
  --bg-color-light: rgba(255, 255, 255, 0.6);
  --glass-bg: rgba(255, 255, 255, 0.45);
}

body.theme-pink {
  --primary-gradient: linear-gradient(135deg, #f7c6d8, #f3dbe5);
  --primary-color: #ff5a9e;
  --primary-color-rgb: 255, 90, 158;
  --text-color: #3a1f2d;
  --text-color-rgb: 58, 31, 45;
}

body.theme-blue {
  --primary-gradient: linear-gradient(135deg, #c6d8f7, #dbe5f3);
  --primary-color: #4a90e2;
  --primary-color-rgb: 74, 144, 226;
  --text-color: #1f2d3a;
  --text-color-rgb: 31, 45, 58;
}

body.theme-green {
  --primary-gradient: linear-gradient(135deg, #c6f7d8, #dbf3e5);
  --primary-color: #28a745;
  --primary-color-rgb: 40, 167, 69;
  --text-color: #1f3a2d;
  --text-color-rgb: 31, 58, 45;
}

body.theme-dark {
  --primary-gradient: linear-gradient(135deg, #2a2a2a, #3a3a3a);
  --primary-color: #ff5a9e;
  --primary-color-rgb: 255, 90, 158;
  --text-color: #ffffff;
  --text-color-rgb: 255, 255, 255;
  --bg-color: rgba(255, 255, 255, 0.1);
  --bg-color-light: rgba(255, 255, 255, 0.2);
  --glass-bg: rgba(30, 30, 30, 0.6);
}

/* Apply theme */
body {
  background: var(--primary-gradient);
  color: var(--text-color);
}

.menu-item {
  background: var(--bg-color-light);
  color: var(--text-color);
}

.menu-item.active {
  border-color: var(--primary-color);
  color: var(--primary-color);
}

/* Responsive */
@media (max-width: 768px) {
  .side-menu {
    width: 60px;
    padding-top: 20px;
    gap: 25px;
  }
  
  .menu-item {
    width: 40px;
    height: 40px;
    font-size: 16px;
  }
  
  .menu-item span {
    font-size: 9px;
  }
  
  .main-content {
    padding: 20px;
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
    gap: 20px;
  }
  
  .stat-card {
    padding: 20px;
  }
}

@media (max-width: 480px) {
  .main-content {
    padding: 15px;
  }
  
  .stats-header h1 {
    font-size: 28px;
  }
  
  .month-stats-grid {
    grid-template-columns: 1fr;
  }
}
</style>
<script src="settings-manager.js"></script>
</head>
<body>
  <!-- SIDE MENU -->
  <div class="side-menu">
    <div class="menu-item" data-page="home">
      üè†
      <span>Home</span>
    </div>
    <div class="menu-item active" data-page="stats">
      üìä
      <span>Stats</span>
    </div>
    <div class="menu-item" data-page="calendar">
      üìÖ
      <span>Calendar</span>
    </div>
    <div class="menu-item" data-page="focus">
      üéØ
      <span>Focus</span>
    </div>
    <div class="menu-item" data-page="ai">
      ü§ñ
      <span>AI Agent</span>
    </div>
    <div class="menu-item" data-page="settings">
      ‚öôÔ∏è
      <span>Settings</span>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="main-content">
    <div class="stats-header">
      <h1>üìä Your Progress Analytics</h1>
      <p>Track your habits, streaks, and consistency over time</p>
    </div>
    
    <div class="stats-grid">
      <!-- Weekly Completion -->
      <div class="stat-card">
        <h3>üìà Weekly Completion</h3>
        <div class="completion-chart" id="weeklyChart"></div>
      </div>
      
      <!-- Current Streaks -->
      <div class="stat-card">
        <h3>üî• Active Streaks</h3>
        <div class="streak-list" id="streakList"></div>
      </div>
      
      <!-- Habit Performance -->
      <div class="stat-card">
        <h3>üéØ Habit Performance</h3>
        <div class="progress-container" id="habitPerformance"></div>
      </div>
      
      <!-- Monthly Overview -->
      <div class="stat-card">
        <h3>üìÖ This Month</h3>
        <div id="monthStats">
          <div class="month-stats-grid">
            <div class="month-stat">
              <div class="month-stat-value" id="monthDays">0/0</div>
              <div class="month-stat-label">Days Completed</div>
            </div>
            <div class="month-stat">
              <div class="month-stat-value" id="bestStreak">0</div>
              <div class="month-stat-label">Best Streak</div>
            </div>
            <div class="month-stat">
              <div class="month-stat-value" id="consistency">0%</div>
              <div class="month-stat-label">Consistency</div>
            </div>
            <div class="month-stat">
              <div class="month-stat-value" id="totalHabits">0</div>
              <div class="month-stat-label">Habits Tracked</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Apply theme
  const savedTheme = localStorage.getItem('dailyLoopTheme') || 'pink';
  document.body.className = '';
  document.body.classList.add(`theme-${savedTheme}`);
  
  // Setup navigation
  document.querySelectorAll('.menu-item').forEach(item => {
    item.addEventListener('click', function() {
      const page = this.dataset.page;
      
      if (page === 'home') window.location.href = 'index.html';
      if (page === 'stats') window.location.href = 'stats.html';
      if (page === 'calendar') window.location.href = 'calendar.html';
      if (page === 'focus') window.location.href = 'focus.html';
      if (page === 'settings') window.location.href = 'settings.html';
      if (page === 'ai') alert('AI Agent coming soon!');
    });
  });
  
  // Highlight current page
  document.querySelectorAll('.menu-item').forEach(item => {
    item.classList.remove('active');
    if (item.dataset.page === 'stats') {
      item.classList.add('active');
    }
  });
  
  // Load statistics
  loadStatsData();
});

function loadStatsData() {
  // Get all habits
  const defaultHabits = JSON.parse(localStorage.getItem('defaultHabits') || '["Drink 3L Water","Study","Exercise","Sleep Early"]');
  
  // Calculate and render statistics
  renderWeeklyChart(defaultHabits);
  renderStreakList(defaultHabits);
  renderHabitPerformance(defaultHabits);
  renderMonthlyStats(defaultHabits);
}

function renderWeeklyChart(habits) {
  const weeklyChart = document.getElementById('weeklyChart');
  if (!weeklyChart) return;
  
  weeklyChart.innerHTML = '';
  
  // Get last 7 days
  const days = [];
  const dayLabels = [];
  
  for (let i = 6; i >= 0; i--) {
    const date = new Date();
    date.setDate(date.getDate() - i);
    days.push(date.toISOString().split('T')[0]);
    dayLabels.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
  }
  
  // Find maximum completion for scaling
  let maxCompletion = 0;
  const completions = days.map(day => {
    const done = JSON.parse(localStorage.getItem(day) || '[]');
    const total = habits.length;
    const percentage = total > 0 ? (done.length / total) * 100 : 0;
    maxCompletion = Math.max(maxCompletion, percentage);
    return percentage;
  });
  
  // Create bars
  completions.forEach((percentage, index) => {
    const container = document.createElement('div');
    container.className = 'chart-bar-container';
    
    const bar = document.createElement('div');
    bar.className = 'chart-bar';
    
    // Scale to fit container (max 90% height)
    const scaledHeight = maxCompletion > 0 ? (percentage / maxCompletion) * 90 : 0;
    bar.style.height = `${scaledHeight}%`;
    
    const dayLabel = document.createElement('div');
    dayLabel.className = 'chart-day';
    dayLabel.textContent = dayLabels[index];
    
    const tooltip = document.createElement('div');
    tooltip.textContent = `${Math.round(percentage)}%`;
    tooltip.style.fontSize = '10px';
    tooltip.style.marginTop = '5px';
    
    container.appendChild(bar);
    container.appendChild(dayLabel);
    container.appendChild(tooltip);
    weeklyChart.appendChild(container);
  });
}

function renderStreakList(habits) {
  const streakList = document.getElementById('streakList');
  if (!streakList) return;
  
  streakList.innerHTML = '';
  
  habits.forEach(habit => {
    const streak = calculateStreak(habit);
    
    const item = document.createElement('div');
    item.className = 'streak-item';
    item.innerHTML = `
      <span>${habit}</span>
      <span class="streak-badge ${getStreakClass(streak)}">üî• ${streak} days</span>
    `;
    
    streakList.appendChild(item);
  });
}

function calculateStreak(habitName) {
  let streak = 0;
  let date = new Date();
  
  while (true) {
    const key = date.toISOString().split('T')[0];
    const done = JSON.parse(localStorage.getItem(key) || '[]');
    
    if (done.includes(habitName)) {
      streak++;
      date.setDate(date.getDate() - 1);
    } else {
      break;
    }
  }
  
  return streak;
}

function getStreakClass(streak) {
  if (streak >= 7) return 'high';
  if (streak >= 3) return 'medium';
  return 'low';
}

function renderHabitPerformance(habits) {
  const habitPerformance = document.getElementById('habitPerformance');
  if (!habitPerformance) return;
  
  habitPerformance.innerHTML = '';
  
  habits.forEach(habit => {
    const container = document.createElement('div');
    container.className = 'habit-progress';
    
    const header = document.createElement('div');
    header.className = 'habit-progress-header';
    
    const habitName = document.createElement('span');
    habitName.textContent = habit;
    
    const completion = calculateHabitCompletion(habit);
    const percentage = Math.round(completion);
    
    const percentageText = document.createElement('span');
    percentageText.textContent = `${percentage}%`;
    percentageText.style.color = 'var(--primary-color)';
    percentageText.style.fontWeight = 'bold';
    
    header.appendChild(habitName);
    header.appendChild(percentageText);
    
    const progressBg = document.createElement('div');
    progressBg.className = 'progress-bg';
    
    const progressFill = document.createElement('div');
    progressFill.className = 'progress-fill';
    progressFill.style.width = `${percentage}%`;
    
    progressBg.appendChild(progressFill);
    
    container.appendChild(header);
    container.appendChild(progressBg);
    habitPerformance.appendChild(container);
  });
}

function calculateHabitCompletion(habitName) {
  let completed = 0;
  let total = 0;
  
  // Check last 30 days
  for (let i = 29; i >= 0; i--) {
    const date = new Date();
    date.setDate(date.getDate() - i);
    const key = date.toISOString().split('T')[0];
    const done = JSON.parse(localStorage.getItem(key) || '[]');
    
    if (done.includes(habitName)) {
      completed++;
    }
    total++;
  }
  
  return total > 0 ? (completed / total) * 100 : 0;
}

function renderMonthlyStats(habits) {
  // Current month
  const today = new Date();
  const year = today.getFullYear();
  const month = today.getMonth();
  
  let completedDays = 0;
  let totalDays = 0;
  let bestStreak = 0;
  let currentStreak = 0;
  
  // Check each day of the current month
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  
  for (let day = 1; day <= daysInMonth; day++) {
    const date = new Date(year, month, day);
    if (date > today) break; // Skip future days
    
    const key = date.toISOString().split('T')[0];
    const done = JSON.parse(localStorage.getItem(key) || '[]');
    
    // Check if all habits are completed for this day
    const allCompleted = habits.length > 0 ? habits.every(habit => done.includes(habit)) : false;
    
    if (allCompleted) {
      completedDays++;
      currentStreak++;
      bestStreak = Math.max(bestStreak, currentStreak);
    } else {
      currentStreak = 0;
    }
    
    totalDays++;
  }
  
  const consistency = totalDays > 0 ? Math.round((completedDays / totalDays) * 100) : 0;
  
  // Update DOM elements
  document.getElementById('monthDays').textContent = `${completedDays}/${totalDays}`;
  document.getElementById('bestStreak').textContent = `${bestStreak}`;
  document.getElementById('consistency').textContent = `${consistency}%`;
  document.getElementById('totalHabits').textContent = habits.length;
}
</script>
</body>
</html>