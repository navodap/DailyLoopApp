<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Settings - DailyLoop</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: "Segoe UI", system-ui, sans-serif;
  background: linear-gradient(135deg, #f7c6d8, #f3dbe5);
  min-height: 100vh;
  color: #3a1f2d;
  display: flex;
}

/* ---------- SIDE MENU ---------- */
.side-menu {
  width: 80px;
  height: 100vh;
  background: rgba(255, 255, 255, 0.25);
  border-right: 1px solid rgba(255, 255, 255, 0.4);
  backdrop-filter: blur(10px);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 40px;
  gap: 35px;
  z-index: 100;
  flex-shrink: 0;
}

.menu-item {
  width: 50px;
  height: 50px;
  border-radius: 14px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.25s ease;
  background: rgba(255, 255, 255, 0.3);
  border: 1px solid rgba(255, 255, 255, 0.4);
  color: #3a1f2d;
  font-size: 20px;
  padding: 6px 0;
}

.menu-item:hover {
  background: rgba(255, 255, 255, 0.6);
  transform: translateY(-2px);
}

.menu-item.active {
  background: rgba(255, 90, 158, 0.2);
  border-color: #ff5a9e;
  color: #ff5a9e;
}

.menu-item span {
  font-size: 11px;
  margin-top: 4px;
  display: block;
  text-align: center;
  width: 100%;
  line-height: 1.2;
}
/* ===== DYNAMIC THEME VARIABLES ===== */
:root {
  --primary-gradient: linear-gradient(135deg, #f7c6d8, #f3dbe5);
  --primary-color: #ff5a9e;
  --text-color: #3a1f2d;
  --bg-color: rgba(255, 255, 255, 0.45);
  --bg-color-light: rgba(255, 255, 255, 0.6);
  --glass-bg: rgba(255, 255, 255, 0.45);
}

body.theme-blue {
  --primary-gradient: linear-gradient(135deg, #c6d8f7, #dbe5f3);
  --primary-color: #4a90e2;
  --text-color: #1f2d3a;
}

body.theme-green {
  --primary-gradient: linear-gradient(135deg, #c6f7d8, #dbf3e5);
  --primary-color: #28a745;
  --text-color: #1f3a2d;
}

body.theme-dark {
  --primary-gradient: linear-gradient(135deg, #2a2a2a, #3a3a3a);
  --primary-color: #ff5a9e;
  --text-color: #ffffff;
  --bg-color: rgba(255, 255, 255, 0.1);
  --bg-color-light: rgba(255, 255, 255, 0.2);
  --glass-bg: rgba(30, 30, 30, 0.6);
}

/* Update all existing styles to use CSS variables */
body {
  background: var(--primary-gradient);
  color: var(--text-color);
}

.glass, .panel {
  background: var(--glass-bg);
}

.month-nav button, .date-carousel button,
.bottom-buttons button, .menu-item {
  background: var(--bg-color-light);
}

.menu-item.active, .today-btn {
  border-color: var(--primary-color);
  color: var(--primary-color);
}

#progressBar, .timer-btn.start, .modal-btn.primary {
  background: var(--primary-color);
}

.streak-badge, .streak-badge.high, .streak-badge.medium, .streak-badge.low {
  background: rgba(var(--primary-color-rgb), 0.15);
  color: var(--primary-color);
}

/* Add this for primary color RGB */
body.theme-pink {
  --primary-color-rgb: 255, 90, 158;
}

body.theme-blue {
  --primary-color-rgb: 74, 144, 226;
}

body.theme-green {
  --primary-color-rgb: 40, 167, 69;
}

body.theme-dark {
  --primary-color-rgb: 255, 90, 158;
}

/* ---------- MAIN CONTENT ---------- */
.main-content {
  flex: 1;
  padding: 30px;
  overflow-y: auto;
  height: 100vh;
}

/* ---------- SETTINGS HEADER ---------- */
.settings-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}

.settings-header h1 {
  font-size: 28px;
  font-weight: 600;
}

.back-btn {
  padding: 10px 20px;
  background: rgba(255, 90, 158, 0.1);
  border: 1px solid #ff5a9e;
  color: #ff5a9e;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.3s;
}

.back-btn:hover {
  background: rgba(255, 90, 158, 0.2);
}

/* ---------- SETTINGS SECTIONS ---------- */
.settings-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 25px;
  max-width: 1200px;
}

.settings-card {
  background: rgba(255, 255, 255, 0.45);
  backdrop-filter: blur(14px);
  border: 1px solid rgba(255, 255, 255, 0.6);
  border-radius: 18px;
  padding: 25px;
  box-shadow: 0 15px 40px rgba(0,0,0,0.08);
}

.settings-card h3 {
  font-size: 18px;
  margin-bottom: 15px;
  color: #ff5a9e;
  display: flex;
  align-items: center;
  gap: 10px;
}

.settings-card h3::before {
  font-size: 20px;
}

/* ---------- SETTING ITEMS ---------- */
.setting-item {
  margin: 20px 0;
  padding-bottom: 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.3);
}

.setting-item:last-child {
  border-bottom: none;
}

.setting-label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
}

.setting-description {
  font-size: 13px;
  color: rgba(58, 31, 45, 0.7);
  margin-top: 5px;
  margin-bottom: 10px;
}

/* ---------- INPUT STYLES ---------- */
select, input[type="time"], input[type="number"] {
  width: 100%;
  padding: 12px 16px;
  border-radius: 12px;
  border: 1px solid rgba(255, 90, 158, 0.3);
  background: rgba(255, 255, 255, 0.7);
  color: #3a1f2d;
  font-size: 14px;
  margin-top: 5px;
}

input[type="color"] {
  width: 60px;
  height: 40px;
  border: none;
  border-radius: 8px;
  background: none;
  cursor: pointer;
}

input[type="checkbox"] {
  width: 20px;
  height: 20px;
  accent-color: #ff5a9e;
  margin-right: 10px;
}

.toggle-switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 26px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(255, 90, 158, 0.2);
  border-radius: 34px;
  transition: .4s;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  border-radius: 50%;
  transition: .4s;
}

input:checked + .toggle-slider {
  background-color: #ff5a9e;
}

input:checked + .toggle-slider:before {
  transform: translateX(24px);
}

/* ---------- BUTTONS ---------- */
.settings-btn {
  padding: 12px 24px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  transition: 0.3s;
  width: 100%;
  margin-top: 10px;
}

.settings-btn.primary {
  background: #ff5a9e;
  color: white;
}

.settings-btn.primary:hover {
  background: #ff4785;
}

.settings-btn.secondary {
  background: rgba(255, 255, 255, 0.6);
  color: #3a1f2d;
}

.settings-btn.secondary:hover {
  background: rgba(255, 255, 255, 0.9);
}

.settings-btn.danger {
  background: rgba(255, 68, 68, 0.1);
  color: #ff4444;
  border: 1px solid #ff4444;
}

.settings-btn.danger:hover {
  background: rgba(255, 68, 68, 0.2);
}

/* ---------- DATA MANAGEMENT ---------- */
.data-stats {
  background: rgba(255, 255, 255, 0.3);
  border-radius: 12px;
  padding: 15px;
  margin: 15px 0;
}

.stat-row {
  display: flex;
  justify-content: space-between;
  margin: 8px 0;
  font-size: 14px;
}

/* ---------- ABOUT SECTION ---------- */
.about-info {
  text-align: center;
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid rgba(255, 255, 255, 0.3);
}

.version {
  font-size: 12px;
  color: rgba(58, 31, 45, 0.6);
  margin-top: 10px;
}

/* ---------- MODAL ---------- */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(5px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

.modal-overlay.active {
  opacity: 1;
  pointer-events: all;
}

.confirm-modal {
  background: rgba(255,255,255,0.95);
  border-radius: 20px;
  padding: 30px;
  width: 90%;
  max-width: 500px;
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255,255,255,0.7);
  box-shadow: 0 25px 50px rgba(0,0,0,0.15);
}

.modal-buttons {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  margin-top: 20px;
}

.modal-btn {
  padding: 10px 20px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  font-weight: 600;
}

.modal-btn.confirm {
  background: #ff4444;
  color: white;
}

.modal-btn.cancel {
  background: rgba(255,255,255,0.6);
  color: #3a1f2d;
}

/* ---------- RESPONSIVE ---------- */
@media (max-width: 768px) {
  .side-menu {
    width: 60px;
  }
  
  .menu-item {
    width: 40px;
    height: 40px;
    font-size: 16px;
  }
  
  .menu-item span {
    font-size: 9px;
  }
  
  .main-content {
    padding: 20px;
  }
  
  .settings-grid {
    grid-template-columns: 1fr;
  }
  
  .settings-header {
    flex-direction: column;
    gap: 15px;
    align-items: flex-start;
  }
}
</style>
<!-- Add this in head section of ALL HTML files -->
<script src="settings-manager.js"></script>
</head>

<body>
<!-- SIDE MENU -->
<div class="side-menu">
  <div class="menu-item" data-page="home">
    üè†
    <span>Home</span>
  </div>
  <div class="menu-item" data-page="stats">
    üìä
    <span>Stats</span>
  </div>
  <div class="menu-item" data-page="calendar">
    üìÖ
    <span>Calendar</span>
  </div>
  <div class="menu-item" data-page="focus">
    üéØ
    <span>Focus</span>
  </div>
  <div class="menu-item" data-page="ai">
    ü§ñ
    <span>AI Agent</span>
  </div>
  <div class="menu-item active" data-page="settings">
    ‚öôÔ∏è
    <span>Settings</span>
  </div>
</div>

<!-- MAIN CONTENT -->
<div class="main-content">
  <div class="settings-header">
    <h1>‚öôÔ∏è Settings</h1>
    <button class="back-btn" onclick="window.location.href='index.html'">‚Üê Back to Home</button>
  </div>

  <div class="settings-grid">
    <!-- GENERAL SETTINGS -->
    <div class="settings-card">
      <h3>üé® General</h3>
      
      <div class="setting-item">
        <label class="setting-label">App Theme</label>
        <div style="display: flex; gap: 10px; margin-top: 10px;">
          <button class="theme-btn" data-theme="pink" style="background: linear-gradient(135deg, #f7c6d8, #f3dbe5);">Pink</button>
          <button class="theme-btn" data-theme="blue" style="background: linear-gradient(135deg, #c6d8f7, #dbe5f3);">Blue</button>
          <button class="theme-btn" data-theme="green" style="background: linear-gradient(135deg, #c6f7d8, #dbf3e5);">Green</button>
          <button class="theme-btn" data-theme="dark" style="background: linear-gradient(135deg, #2a2a2a, #3a3a3a); color: white;">Dark</button>
        </div>
      </div>

      <div class="setting-item">
        <label class="setting-label">Default Date View</label>
        <select id="defaultView">
          <option value="daily">Daily View</option>
          <option value="weekly">Weekly View</option>
          <option value="monthly">Monthly View</option>
        </select>
      </div>

      <div class="setting-item">
        <label class="setting-label">Week Start Day</label>
        <select id="weekStart">
          <option value="0">Sunday</option>
          <option value="1">Monday</option>
        </select>
      </div>

      <div class="setting-item">
        <label class="setting-label">
          <input type="checkbox" id="autoProgress" checked>
          Show Progress Animation
        </label>
        <div class="setting-description">Animate progress bars and transitions</div>
      </div>
    </div>

    <!-- HABITS & TASKS -->
    <div class="settings-card">
      <h3>‚úÖ Habits & Tasks</h3>
      
      <div class="setting-item">
        <label class="setting-label">Daily Reminder Time</label>
        <input type="time" id="reminderTime" value="09:00">
        <div class="setting-description">Get notified to review your daily habits</div>
      </div>

      <div class="setting-item">
        <label class="setting-label">
          <input type="checkbox" id="autoResetTasks">
          Auto-reset unchecked tasks
        </label>
        <div class="setting-description">Unchecked tasks reset at midnight</div>
      </div>

      <div class="setting-item">
        <label class="setting-label">
          <input type="checkbox" id="showStreaks" checked>
          Show Streak Counters
        </label>
        <div class="setting-description">Display üî• streak badges next to habits</div>
      </div>

      <div class="setting-item">
        <label class="setting-label">
          <input type="checkbox" id="enableHabitSnooze">
          Enable Habit Snooze
        </label>
        <div class="setting-description">Allow postponing habits to later in the day</div>
      </div>

      <button class="settings-btn secondary" onclick="window.location.href='index.html#editHabits'">
        ‚úèÔ∏è Edit Daily Habits
      </button>
    </div>

    <!-- FOCUS TIMER -->
    <div class="settings-card">
      <h3>‚è±Ô∏è Focus Timer</h3>
      
      <div class="setting-item">
        <label class="setting-label">Default Focus Duration (minutes)</label>
        <input type="number" id="focusDuration" min="5" max="120" value="25">
      </div>

      <div class="setting-item">
        <label class="setting-label">Break Duration (minutes)</label>
        <input type="number" id="breakDuration" min="1" max="30" value="5">
      </div>

      <div class="setting-item">
        <label class="setting-label">Focus Sessions per Day Goal</label>
        <input type="number" id="sessionsGoal" min="1" max="20" value="4">
      </div>

      <div class="setting-item">
        <label class="setting-label">Default Visual Mode</label>
        <select id="focusVisualMode">
          <option value="tree">üå≥ Grow a Tree</option>
          <option value="castle">üè∞ Build a Castle</option>
          <option value="flower">üå∏ Bloom a Flower</option>
        </select>
      </div>

      <div class="setting-item">
        <label class="setting-label">
          <input type="checkbox" id="enableFocusSounds" checked>
          Enable Timer Sounds
        </label>
      </div>

      <div class="setting-item">
        <label class="setting-label">
          <input type="checkbox" id="autoStartBreaks">
          Auto-start breaks
        </label>
        <div class="setting-description">Automatically start break timer after focus</div>
      </div>
    </div>

    <!-- NOTIFICATIONS -->
    <div class="settings-card">
      <h3>üîî Notifications</h3>
      
      <div class="setting-item">
        <label class="setting-label">
          <label class="toggle-switch">
            <input type="checkbox" id="enableNotifications" checked>
            <span class="toggle-slider"></span>
          </label>
          Enable Notifications
        </label>
        <div class="setting-description">Get browser notifications</div>
      </div>

      <div class="setting-item">
        <label class="setting-label">Habit Check-in Reminders</label>
        <select id="reminderFrequency">
          <option value="none">No reminders</option>
          <option value="morning">Morning only</option>
          <option value="evening">Evening only</option>
          <option value="both" selected>Morning & Evening</option>
        </select>
      </div>

      <div class="setting-item">
        <label class="setting-label">
          <input type="checkbox" id="streakReminders">
          Streak Reminders
        </label>
        <div class="setting-description">Notify when you're close to beating a streak</div>
      </div>

      <div class="setting-item">
        <label class="setting-label">
          <input type="checkbox" id="focusReminders">
          Focus Session Reminders
        </label>
        <div class="setting-description">Remind to take focus sessions</div>
      </div>

      <button class="settings-btn secondary" onclick="requestNotificationPermission()">
        üì± Test Notifications
      </button>
    </div>

    <!-- DATA MANAGEMENT -->
    <div class="settings-card">
      <h3>üíæ Data Management</h3>
      
      <div class="data-stats">
        <div class="stat-row">
          <span>Habits Tracked:</span>
          <span id="habitsCount">0</span>
        </div>
        <div class="stat-row">
          <span>Focus Sessions:</span>
          <span id="sessionsCount">0</span>
        </div>
        <div class="stat-row">
          <span>Total Check-ins:</span>
          <span id="checkinsCount">0</span>
        </div>
        <div class="stat-row">
          <span>Storage Used:</span>
          <span id="storageUsed">0 KB</span>
        </div>
      </div>

      <button class="settings-btn secondary" onclick="exportData()">
        üì• Export All Data
      </button>
      
      <button class="settings-btn secondary" onclick="importData()">
        üì§ Import Data
      </button>
      
      <button class="settings-btn danger" onclick="showClearDataModal()">
        üóëÔ∏è Clear All Data
      </button>

      <div class="setting-description" style="margin-top: 15px; font-size: 12px;">
        Your data is stored locally in your browser. Export regularly for backup.
      </div>
    </div>

    <!-- ABOUT & INFO -->
    <div class="settings-card">
      <h3>‚ÑπÔ∏è About DailyLoop</h3>
      
      <div class="setting-item">
        <p style="margin-bottom: 15px; line-height: 1.6;">
          DailyLoop is a minimalist productivity tool designed to help you build consistent habits and stay focused.
        </p>
        
        <div style="margin: 20px 0;">
          <a href="#" onclick="showWhatsNew()" style="color: #ff5a9e; text-decoration: none; display: block; margin: 10px 0;">
            üì£ What's New
          </a>
          <a href="#" onclick="showHelp()" style="color: #ff5a9e; text-decoration: none; display: block; margin: 10px 0;">
            ‚ùì Help & Documentation
          </a>
          <a href="#" onclick="showPrivacy()" style="color: #ff5a9e; text-decoration: none; display: block; margin: 10px 0;">
            üîí Privacy Policy
          </a>
        </div>
      </div>

      <div class="about-info">
        <p>Made with ‚ù§Ô∏è for productivity</p>
        <div class="version">Version 1.0.0 ¬∑ Build 2024.03</div>
      </div>
    </div>
  </div>
</div>

<!-- CLEAR DATA MODAL -->
<div class="modal-overlay" id="clearDataModal">
  <div class="confirm-modal">
    <h2 style="color: #ff4444; margin-bottom: 10px;">‚ö†Ô∏è Clear All Data</h2>
    <p>This will permanently delete all your habits, focus sessions, and progress data. This action cannot be undone.</p>
    <p style="margin-top: 10px; font-weight: bold;">Are you absolutely sure?</p>
    <div class="modal-buttons">
      <button class="modal-btn cancel" onclick="hideClearDataModal()">Cancel</button>
      <button class="modal-btn confirm" onclick="clearAllData()">Yes, Delete Everything</button>
    </div>
  </div>
</div>

<!-- IMPORT MODAL -->
<div class="modal-overlay" id="importModal">
  <div class="confirm-modal">
    <h2>üì§ Import Data</h2>
    <p>Select a backup file to import:</p>
    <input type="file" id="importFile" accept=".json" style="margin: 15px 0; padding: 10px; width: 100%;">
    <div class="modal-buttons">
      <button class="modal-btn cancel" onclick="hideImportModal()">Cancel</button>
      <button class="modal-btn confirm" onclick="processImport()" style="background: #ff5a9e;">Import</button>
    </div>
  </div>
</div>

<script>
// Load saved settings
document.addEventListener('DOMContentLoaded', function() {
  loadSettings();
  updateDataStats();
  
  // Navigation
  document.querySelectorAll('.menu-item').forEach(item => {
    item.addEventListener('click', function() {
      const page = this.dataset.page;
      if (page === 'home') window.location.href = 'index.html';
      if (page === 'stats') window.location.href = 'stats.html';
      if (page === 'calendar') window.location.href = 'calendar.html';
      if (page === 'focus') window.location.href = 'focus.html';
      if (page === 'ai') alert('AI Agent coming soon!');
      if (page === 'settings') window.location.href = 'settings.html';
    });
  });
  
  // Theme buttons
  document.querySelectorAll('.theme-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const theme = this.dataset.theme;
      setTheme(theme);
    });
  });
  
  // Save settings on change
  document.querySelectorAll('select, input[type="checkbox"], input[type="time"], input[type="number"]').forEach(el => {
    el.addEventListener('change', saveSettings);
  });
});

// SETTINGS FUNCTIONS
function loadSettings() {
  const settings = JSON.parse(localStorage.getItem('dailyLoopSettings') || '{}');
  
  // Apply settings to form elements
  document.getElementById('defaultView').value = settings.defaultView || 'daily';
  document.getElementById('weekStart').value = settings.weekStart || '0';
  document.getElementById('autoProgress').checked = settings.autoProgress !== false;
  document.getElementById('reminderTime').value = settings.reminderTime || '09:00';
  document.getElementById('autoResetTasks').checked = settings.autoResetTasks || false;
  document.getElementById('showStreaks').checked = settings.showStreaks !== false;
  document.getElementById('enableHabitSnooze').checked = settings.enableHabitSnooze || false;
  document.getElementById('focusDuration').value = settings.focusDuration || 25;
  document.getElementById('breakDuration').value = settings.breakDuration || 5;
  document.getElementById('sessionsGoal').value = settings.sessionsGoal || 4;
  document.getElementById('focusVisualMode').value = settings.focusVisualMode || 'tree';
  document.getElementById('enableFocusSounds').checked = settings.enableFocusSounds !== false;
  document.getElementById('autoStartBreaks').checked = settings.autoStartBreaks || false;
  document.getElementById('enableNotifications').checked = settings.enableNotifications !== false;
  document.getElementById('reminderFrequency').value = settings.reminderFrequency || 'both';
  document.getElementById('streakReminders').checked = settings.streakReminders || false;
  document.getElementById('focusReminders').checked = settings.focusReminders || false;
  
  // Apply theme if set
  if (settings.theme) {
    setTheme(settings.theme, false);
  }
}

function saveSettings() {
  const settings = {
    defaultView: document.getElementById('defaultView').value,
    weekStart: document.getElementById('weekStart').value,
    autoProgress: document.getElementById('autoProgress').checked,
    reminderTime: document.getElementById('reminderTime').value,
    autoResetTasks: document.getElementById('autoResetTasks').checked,
    showStreaks: document.getElementById('showStreaks').checked,
    enableHabitSnooze: document.getElementById('enableHabitSnooze').checked,
    focusDuration: parseInt(document.getElementById('focusDuration').value),
    breakDuration: parseInt(document.getElementById('breakDuration').value),
    sessionsGoal: parseInt(document.getElementById('sessionsGoal').value),
    focusVisualMode: document.getElementById('focusVisualMode').value,
    enableFocusSounds: document.getElementById('enableFocusSounds').checked,
    autoStartBreaks: document.getElementById('autoStartBreaks').checked,
    enableNotifications: document.getElementById('enableNotifications').checked,
    reminderFrequency: document.getElementById('reminderFrequency').value,
    streakReminders: document.getElementById('streakReminders').checked,
    focusReminders: document.getElementById('focusReminders').checked,
    theme: localStorage.getItem('dailyLoopTheme') || 'pink'
  };
  
  localStorage.setItem('dailyLoopSettings', JSON.stringify(settings));
  showToast('Settings saved!');
}

function setTheme(theme, save = true) {
  const body = document.body;
  
  // Remove existing theme classes
  body.classList.remove('theme-pink', 'theme-blue', 'theme-green', 'theme-dark');
  
  // Add new theme class
  body.classList.add('theme-' + theme);
  
  // Update CSS variables
  if (theme === 'pink') {
    body.style.background = 'linear-gradient(135deg, #f7c6d8, #f3dbe5)';
  } else if (theme === 'blue') {
    body.style.background = 'linear-gradient(135deg, #c6d8f7, #dbe5f3)';
  } else if (theme === 'green') {
    body.style.background = 'linear-gradient(135deg, #c6f7d8, #dbf3e5)';
  } else if (theme === 'dark') {
    body.style.background = 'linear-gradient(135deg, #2a2a2a, #3a3a3a)';
    body.style.color = '#ffffff';
  }
  
  if (save) {
    localStorage.setItem('dailyLoopTheme', theme);
    saveSettings();
  }
}

// DATA MANAGEMENT FUNCTIONS
function updateDataStats() {
  // Count habits
  const defaultHabits = JSON.parse(localStorage.getItem('defaultHabits') || '[]');
  document.getElementById('habitsCount').textContent = defaultHabits.length;
  
  // Count focus sessions
  const focusSessions = JSON.parse(localStorage.getItem('focusSessions') || '0');
  document.getElementById('sessionsCount').textContent = focusSessions;
  
  // Count total check-ins
  let checkins = 0;
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.includes('-')) { // Date keys
      const data = JSON.parse(localStorage.getItem(key) || '[]');
      checkins += data.length;
    }
  }
  document.getElementById('checkinsCount').textContent = checkins;
  
  // Calculate storage
  const total = JSON.stringify(localStorage).length;
  document.getElementById('storageUsed').textContent = Math.round(total / 1024) + ' KB';
}

function exportData() {
  const allData = {};
  
  // Collect all localStorage data
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    allData[key] = localStorage.getItem(key);
  }
  
  // Add export metadata
  allData._export = {
    date: new Date().toISOString(),
    version: '1.0.0',
    app: 'DailyLoop'
  };
  
  const dataStr = JSON.stringify(allData, null, 2);
  const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
  
  const link = document.createElement('a');
  link.setAttribute('href', dataUri);
  link.setAttribute('download', `dailyloop-backup-${new Date().toISOString().split('T')[0]}.json`);
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  
  showToast('Data exported successfully!');
}

function importData() {
  document.getElementById('importModal').classList.add('active');
}

function processImport() {
  const fileInput = document.getElementById('importFile');
  const file = fileInput.files[0];
  
  if (!file) {
    alert('Please select a file to import');
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      
      // Verify it's a DailyLoop backup
      if (!data._export || data._export.app !== 'DailyLoop') {
        throw new Error('Invalid backup file');
      }
      
      // Clear existing data
      localStorage.clear();
      
      // Import all data
      Object.keys(data).forEach(key => {
        if (key !== '_export') {
          localStorage.setItem(key, typeof data[key] === 'string' ? data[key] : JSON.stringify(data[key]));
        }
      });
      
      hideImportModal();
      showToast('Data imported successfully!');
      setTimeout(() => {
        window.location.reload();
      }, 1000);
      
    } catch (error) {
      alert('Error importing data: ' + error.message);
    }
  };
  
  reader.readAsText(file);
}

function hideImportModal() {
  document.getElementById('importModal').classList.remove('active');
}

function showClearDataModal() {
  document.getElementById('clearDataModal').classList.add('active');
}

function hideClearDataModal() {
  document.getElementById('clearDataModal').classList.remove('active');
}

function clearAllData() {
  // Keep only settings
  const settings = localStorage.getItem('dailyLoopSettings');
  const theme = localStorage.getItem('dailyLoopTheme');
  
  localStorage.clear();
  
  // Restore settings
  if (settings) localStorage.setItem('dailyLoopSettings', settings);
  if (theme) localStorage.setItem('dailyLoopTheme', theme);
  
  hideClearDataModal();
  showToast('All data cleared!');
  setTimeout(() => {
    window.location.reload();
  }, 1000);
}

// NOTIFICATION FUNCTIONS
function requestNotificationPermission() {
  if (!("Notification" in window)) {
    alert("This browser does not support notifications");
    return;
  }
  
  if (Notification.permission === "granted") {
    testNotification();
  } else if (Notification.permission !== "denied") {
    Notification.requestPermission().then(permission => {
      if (permission === "granted") {
        testNotification();
      }
    });
  }
}

function testNotification() {
  new Notification("DailyLoop Test", {
    body: "Notifications are working correctly!",
    icon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üåÄ</text></svg>"
  });
  showToast('Test notification sent!');
}

// UTILITY FUNCTIONS
function showToast(message) {
  // Create toast element
  const toast = document.createElement('div');
  toast.textContent = message;
  toast.style.cssText = `
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255, 90, 158, 0.9);
    color: white;
    padding: 12px 24px;
    border-radius: 12px;
    z-index: 10000;
    animation: fadeInOut 2s ease-in-out;
  `;
  
  // Add keyframes
  const style = document.createElement('style');
  style.textContent = `
    @keyframes fadeInOut {
      0% { opacity: 0; bottom: 0; }
      10% { opacity: 1; bottom: 20px; }
      90% { opacity: 1; bottom: 20px; }
      100% { opacity: 0; bottom: 20px; }
    }
  `;
  document.head.appendChild(style);
  
  document.body.appendChild(toast);
  
  // Remove after animation
  setTimeout(() => {
    toast.remove();
    style.remove();
  }, 2000);
}

// INFO FUNCTIONS
function showWhatsNew() {
  alert("What's New in v1.0:\n\n‚Ä¢ Complete habit tracking system\n‚Ä¢ Focus timer with visual progress\n‚Ä¢ Calendar heatmap view\n‚Ä¢ Detailed statistics\n‚Ä¢ Customizable settings\n‚Ä¢ Data import/export\n‚Ä¢ Responsive design");
}

function showHelp() {
  alert("DailyLoop Help:\n\n1. Add habits in the main screen\n2. Check off habits daily to build streaks\n3. Use the focus timer for concentrated work\n4. View your progress in calendar and stats\n5. Customize settings to your preference");
}

function showPrivacy() {
  alert("Privacy Policy:\n\n‚Ä¢ All data is stored locally in your browser\n‚Ä¢ No data is sent to any servers\n‚Ä¢ You own 100% of your data\n‚Ä¢ Export your data anytime for backup\n‚Ä¢ Clear data anytime from Settings");
}

// Initialize theme
const savedTheme = localStorage.getItem('dailyLoopTheme') || 'pink';
setTheme(savedTheme, false);
// Apply settings when page loads
document.addEventListener('DOMContentLoaded', function() {
  // Initialize settings manager
  if (typeof SettingsManager !== 'undefined') {
    SettingsManager.init();
    
    // Apply saved theme immediately
    const savedTheme = localStorage.getItem('dailyLoopTheme') || SettingsManager.get('theme');
    if (savedTheme) {
      document.body.className = '';
      document.body.classList.add(`theme-${savedTheme}`);
    }
  }
  
  // Highlight current page in menu
  const currentPage = window.location.pathname.split('/').pop() || 'index.html';
  const pageMap = {
    'index.html': 'home',
    'stats.html': 'stats',
    'calendar.html': 'calendar',
    'focus.html': 'focus',
    'settings.html': 'settings'
  };
  
  const currentPageId = pageMap[currentPage] || 'home';
  document.querySelectorAll('.menu-item').forEach(item => {
    item.classList.remove('active');
    if (item.dataset.page === currentPageId) {
      item.classList.add('active');
    }
  });
});
</script>
</body>
</html>